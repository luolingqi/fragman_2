OPEN READ UNIT 10 CARD NAME "_RTF_"
READ RTF UNIT 10 CARD
CLOSE UNIT 10

OPEN READ UNIT 11 CARD NAME "_PRM_"
READ PARAMETERS UNIT 11 CARD
CLOSE UNIT 11

OPEN READ UNIT 13 CARD NAME  "_REC_"
READ SEQUENCE PDB UNIT 13

GENERATE _SEGID_ SETUP FIRST NONE LAST NONE

REWIND UNIT 13
READ COORDINATE PDB UNIT 13
CLOSE UNIT 13


IC FILL PRESERVE
IC PARAMETERS
IC BUILD
HBUILD


! harmonic constraint of backbone atoms
! to resolve side chain vdW clashes
CONS HARM SELE (TYPE C .OR. TYPE N .OR. TYPE CA .OR. TYPE O) END FORCE 20 MASS END


ENER ATOM ACE IEPS 4.0 SEPS 78.0 ALPHa 1.2 SIGMa 3 SWITch -
       VDIS VSWI CUTNB 15.0 CTONNB 8.0 CTOFNB 13.0


! minimize, allow slight adjustments of x_0 in harmonic
! minization by doing iterative minimization
SET i 0
LABEL BEGIN
IF i GE _NSTEPS_ GOTO FINISH
MINIMIZE ABNR NSTEP 10 NPRINT 10 TOLENR 0.0001 TOLGRD 0.0001
INCREMENT i BY 1
GOTO BEGIN
LABEL FINISH

! fix everything to obtain self energy
CONS FIX SELE SEGID _SEGID_ END

ENER ATOM ACE IEPS 4.0 SEPS 78.0 ALPHa 1.2 SIGMa 3 SWITch -
       VDIS VSWI CUTNB 15.0 CTONNB 8.0 CTOFNB 13.0

OPEN UNIT 52 NAME  "_RECMIN_.ener" WRITE FORM
WRITE ENER UNIT 52
CLOSE UNIT 52


OPEN UNIT 21 NAME "_RECMIN_" WRITE FORM
! WRITE TITLE UNIT 21
! *MM ?BOND ?DIHE ?ANGL ?IMPR ?VDW ?ELEC ?ENER
WRITE COOR PDB UNIT 21
CLOSE UNIT 21


STOP
